<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>PNCP Monitor - An√°lise Completa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --primary: #1e40af;
      --primary-dark: #1e3a8a;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --border: #e2e8f0;
      --danger: #dc2626;
      --success: #059669;
      --warning: #d97706;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px;
    }

    header {
      background: var(--primary);
      color: #fff;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    header h1 {
      margin: 0 0 4px 0;
      font-size: 1.5rem;
    }

    header p {
      margin: 0;
      font-size: 0.95rem;
      opacity: 0.9;
    }

    #status {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      margin: 12px 0;
    }

    .status-loading { background: #fef3c7; color: #92400e; }
    .status-success { background: #d1fae5; color: #065f46; }
    .status-error   { background: #fee2e2; color: #991b1b; }

    .controls {
      background: var(--card);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    }

    .controls-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .controls label {
      font-size: 0.85rem;
      color: #475569;
    }

    .controls input,
    .controls select {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 0.9rem;
    }

    .controls button {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #111827;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .btn-link {
      background: var(--primary);
      color: #fff;
      padding: 4px 8px;
      font-size: 0.75rem;
    }

    .btn-link:hover {
      background: var(--primary-dark);
    }

    .table-wrapper {
      background: var(--card);
      border-radius: 8px;
      border: 1px solid var(--border);
      overflow: auto;
      margin-bottom: 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    th, td {
      border-bottom: 1px solid var(--border);
      padding: 6px 8px;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 1;
      font-weight: 600;
    }

    tr:nth-child(even) td {
      background: #f9fafb;
    }

    a {
      color: var(--primary);
      text-decoration: none;
    }

    a:hover { text-decoration: underline; }

    .tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.75rem;
      margin: 2px 2px;
    }

    .tag-ok { background: #dcfce7; color: var(--success); }
    .tag-warn { background: #fef3c7; color: var(--warning); }
    .tag-bad { background: #fee2e2; color: var(--danger); }

    .pagination {
      margin: 8px 0;
      font-size: 0.85rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pagination button {
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
      font-size: 0.8rem;
      background: #fff;
      cursor: pointer;
    }

    .pagination button:disabled {
      opacity: 0.5;
      cursor: default;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 50;
      align-items: center;
      justify-content: center;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #fff;
      max-width: 1200px;
      width: 95%;
      max-height: 90vh;
      border-radius: 8px;
      overflow: auto;
      border: 1px solid var(--border);
      margin: 20px auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid var(--border);
      background: #f1f5f9;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .modal-header h2 {
      font-size: 1rem;
      margin: 0;
    }

    .modal-close {
      border: none;
      background: none;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .modal-body {
      padding: 12px;
    }

    /* Abas */
    .tabs {
      display: flex;
      gap: 4px;
      border-bottom: 2px solid var(--border);
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 8px 12px;
      border: none;
      background: #e5e7eb;
      cursor: pointer;
      border-radius: 4px 4px 0 0;
      font-size: 0.85rem;
      transition: background 0.2s;
    }

    .tab-btn.active {
      background: var(--primary);
      color: #fff;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Resumo */
    .resumo-box {
      background: #f8fafc;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 12px;
      border-left: 4px solid var(--primary);
    }

    .resumo-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 0.9rem;
    }

    .resumo-item strong {
      color: var(--primary);
    }

    .valor {
      font-weight: 600;
      color: var(--success);
      font-family: 'Courier New', monospace;
    }

    .link-pncp {
      display: inline-block;
      margin-top: 4px;
    }

    @media (max-width: 768px) {
      th, td {
        padding: 4px 6px;
        font-size: 0.75rem;
      }
      header h1 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>PNCP Monitor ‚Äì An√°lise Completa</h1>
      <p>Preg√£o Eletr√¥nico ‚Äì Seus itens ganhos, concorrentes e fracassados.</p>
    </header>

    <div id="status" class="status-loading">
      Carregando dados do PNCP...
    </div>

    <div class="controls">
      <div class="controls-group">
        <label for="busca">Busca:</label>
        <input id="busca" type="text" placeholder="√ìrg√£o, objeto, fornecedor...">
      </div>

      <div class="controls-group">
        <label for="filtro-uf">UF:</label>
        <select id="filtro-uf">
          <option value="">Todas</option>
        </select>
      </div>

      <div class="controls-group">
        <button class="btn-secondary" id="btn-limpar">Limpar</button>
        <button class="btn-primary" id="btn-aplicar">Aplicar</button>
      </div>
    </div>

    <div class="pagination">
      <span id="info-resultado">0 licita√ß√µes</span>
      <div>
        <button id="prev-page">&laquo; Anterior</button>
        <span id="page-info">P√°gina 1</span>
        <button id="next-page">Pr√≥xima &raquo;</button>
      </div>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>√ìrg√£o/UASG</th>
            <th>Preg√£o</th>
            <th>Per√≠odo Propostas</th>
            <th>Cidade/UF</th>
            <th>Objeto (sint√©tico)</th>
            <th>Seus Itens</th>
            <th>Total Ganho</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="corpo-tabela"></tbody>
      </table>
    </div>
  </div>

  <!-- Modal de an√°lise completa -->
  <div id="modal-analise" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h2 id="modal-titulo">An√°lise da Licita√ß√£o</h2>
          <div class="link-pncp">
            <a id="modal-link-pncp" href="#" target="_blank" class="btn-link">üîó Abrir no PNCP</a>
          </div>
        </div>
        <button class="modal-close" id="modal-fechar">&times;</button>
      </div>
      <div class="modal-body">
        
        <!-- Resumo r√°pido -->
        <div class="resumo-box">
          <div class="resumo-item">
            <strong>Total ganho por voc√™:</strong>
            <span class="valor" id="resumo-total-seu">R$ 0,00</span>
          </div>
          <div class="resumo-item">
            <strong>Itens (seus):</strong>
            <span id="resumo-itens-seu">0</span>
          </div>
          <div class="resumo-item">
            <strong>Itens (outros fornecedores):</strong>
            <span id="resumo-itens-outros">0</span>
          </div>
          <div class="resumo-item">
            <strong>Itens fracassados:</strong>
            <span id="resumo-itens-fracasso">0</span>
          </div>
        </div>

        <!-- Abas -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="seus-itens">Seus Itens</button>
          <button class="tab-btn" data-tab="todos-fornecedores">Todos Fornecedores</button>
          <button class="tab-btn" data-tab="fracassados">Fracassados</button>
        </div>

        <!-- Aba 1: Seus Itens -->
        <div id="seus-itens" class="tab-content active">
          <h3>Itens Ganhos por Voc√™</h3>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Descri√ß√£o</th>
                  <th>Qtd</th>
                  <th>Valor Unit.</th>
                  <th>Valor Total</th>
                  <th>Data Homol.</th>
                </tr>
              </thead>
              <tbody id="tab-seus-itens-corpo"></tbody>
            </table>
          </div>

          <h3 style="margin-top: 16px;">Resumo por Fornecedor (Voc√™)</h3>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Fornecedor</th>
                  <th>CNPJ</th>
                  <th>Total Ganho</th>
                </tr>
              </thead>
              <tbody id="tab-resumo-fornecedor-corpo"></tbody>
            </table>
          </div>
        </div>

        <!-- Aba 2: Todos Fornecedores -->
        <div id="todos-fornecedores" class="tab-content">
          <h3>Todos os Fornecedores e Seus Itens</h3>
          <p style="font-size: 0.9rem; color: #666;">
            Inclui seus itens + itens ganhos por concorrentes. Compare suas ofertas com as vencedoras.
          </p>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Descri√ß√£o</th>
                  <th>Fornecedor</th>
                  <th>CNPJ</th>
                  <th>Qtd</th>
                  <th>Valor Unit.</th>
                  <th>Valor Total</th>
                  <th>Data Homol.</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="tab-todos-fornecedores-corpo"></tbody>
            </table>
          </div>
        </div>

        <!-- Aba 3: Fracassados -->
        <div id="fracassados" class="tab-content">
          <h3>Itens Fracassados ou Desertos</h3>
          <p style="font-size: 0.9rem; color: #666;">
            Itens que n√£o tiveram resultado ou nenhum fornecedor ganhou. Oportunidades para complementa√ß√£o.
          </p>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Descri√ß√£o</th>
                  <th>Qtd Estimada</th>
                  <th>Valor Estimado Unit.</th>
                  <th>Valor Estimado Total</th>
                  <th>Situa√ß√£o</th>
                </tr>
              </thead>
              <tbody id="tab-fracassados-corpo"></tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const ITENS_POR_PAGINA = 20;
    let dadosCompletos = [];
    let dadosFiltrados = [];
    let paginaAtual = 1;

    async function carregarDadosPncp() {
      const status = document.getElementById('status');
      status.textContent = 'Carregando dados do PNCP...';
      status.className = 'status-loading';

      try {
        const resp = await fetch('dados_pncp.json?t=' + Date.now(), { cache: 'no-store' });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        dadosCompletos = await resp.json();
        dadosFiltrados = dadosCompletos.slice();
        preencherFiltroUF();
        paginaAtual = 1;
        atualizarTabela();
        status.textContent = 'Dados carregados com sucesso.';
        status.className = 'status-success';
      } catch (e) {
        status.textContent = 'Erro ao carregar: ' + e.message;
        status.className = 'status-error';
      }
    }

    function preencherFiltroUF() {
      const selectUF = document.getElementById('filtro-uf');
      const ufs = new Set();
      dadosCompletos.forEach(lic => {
        if (lic.uf) ufs.add(lic.uf);
      });
      const ordenadas = Array.from(ufs).sort();
      selectUF.innerHTML = '<option value="">Todas</option>';
      ordenadas.forEach(uf => {
        const opt = document.createElement('option');
        opt.value = uf;
        opt.textContent = uf;
        selectUF.appendChild(opt);
      });
    }

    function aplicarFiltros() {
      const termo = document.getElementById('busca').value.toLowerCase().trim();
      const uf = document.getElementById('filtro-uf').value;

      dadosFiltrados = dadosCompletos.filter(lic => {
        let ok = true;

        if (termo) {
          const texto = [
            lic.orgao_nome,
            lic.numero_pregao,
            lic.objeto,
            lic.cidade,
            lic.id_pncp,
            ...(lic.itens || []).map(i => i.descricao + ' ' + i.fornecedor),
            ...(lic.itens_todos_fornecedores || []).map(i => i.fornecedor)
          ].join(' ').toLowerCase();
          if (!texto.includes(termo)) ok = false;
        }

        if (uf && lic.uf !== uf) ok = false;

        return ok;
      });

      paginaAtual = 1;
      atualizarTabela();
    }

    function calcularTotalSeu(lic) {
      if (!lic.itens) return 0;
      return lic.itens.reduce((sum, item) => sum + (item.valor_total_item || 0), 0);
    }

    function atualizarTabela() {
      const corpo = document.getElementById('corpo-tabela');
      corpo.innerHTML = '';

      const total = dadosFiltrados.length;
      const inicio = (paginaAtual - 1) * ITENS_POR_PAGINA;
      const fim = Math.min(inicio + ITENS_POR_PAGINA, total);
      const paginaDados = dadosFiltrados.slice(inicio, fim);

      paginaDados.forEach((lic, indexLocal) => {
        const idxGlobal = inicio + indexLocal;
        const tr = document.createElement('tr');

        const qtdItens = lic.itens ? lic.itens.length : 0;
        const totalSeu = calcularTotalSeu(lic);

        tr.innerHTML = `
          <td>
            ${lic.orgao_codigo || ''}/${lic.uasg || ''}<br>
            <small>${lic.orgao_nome || ''}</small>
          </td>
          <td>
            ${lic.numero_pregao || ''}<br>
            <a href="${lic.link_edital || '#'}" target="_blank" style="font-size: 0.75rem;">
              ${lic.id_pncp || ''}
            </a>
          </td>
          <td>${formatarData(lic.data_inicio_propostas)} a ${formatarData(lic.data_fim_propostas)}</td>
          <td>${lic.cidade || ''} / ${lic.uf || ''}</td>
          <td>${(lic.objeto || '').substring(0, 60)}${lic.objeto && lic.objeto.length > 60 ? '...' : ''}</td>
          <td>${qtdItens}</td>
          <td>${formatarMoeda(totalSeu)}</td>
          <td>
            <button type="button" data-idx="${idxGlobal}" class="btn-secondary btn-analise" style="padding: 4px 8px; font-size: 0.75rem;">
              Analisar
            </button>
          </td>
        `;
        corpo.appendChild(tr);
      });

      document.getElementById('info-resultado').textContent =
        `${total} licita√ß√£o${total !== 1 ? 'es' : ''} (${inicio + 1}-${fim})`;

      const totalPaginas = Math.max(1, Math.ceil(total / ITENS_POR_PAGINA));
      document.getElementById('page-info').textContent = `P√°gina ${paginaAtual} de ${totalPaginas}`;
      document.getElementById('prev-page').disabled = paginaAtual <= 1;
      document.getElementById('next-page').disabled = paginaAtual >= totalPaginas;

      document.querySelectorAll('.btn-analise').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.getAttribute('data-idx'), 10);
          abrirModalAnalise(idx);
        });
      });
    }

    function abrirModalAnalise(idxGlobal) {
      const lic = dadosFiltrados[idxGlobal];
      if (!lic) return;

      // Atualizar t√≠tulo
      document.getElementById('modal-titulo').textContent =
        `${lic.numero_pregao} ‚Äì ${lic.orgao_nome}`;

      // Atualizar link PNCP
      document.getElementById('modal-link-pncp').href = lic.link_edital || '#';

      // Resumo r√°pido
      const totalSeu = calcularTotalSeu(lic);
      const qtdSeus = lic.itens ? lic.itens.length : 0;
      const qtdOutros = lic.itens_todos_fornecedores ? lic.itens_todos_fornecedores.length : 0;
      const qtdFracasso = (lic.itens_todos_fornecedores || []).filter(i => i.situacao === 'SemResultado').length;

      document.getElementById('resumo-total-seu').textContent = formatarMoeda(totalSeu);
      document.getElementById('resumo-itens-seu').textContent = qtdSeus;
      document.getElementById('resumo-itens-outros').textContent = qtdOutros;
      document.getElementById('resumo-itens-fracasso').textContent = qtdFracasso;

      // Seus itens
      preencherTabelaSeuItens(lic);

      // Todos fornecedores
      preencherTabelaTodosFornecedores(lic);

      // Fracassados
      preencherTabelaFracassados(lic);

      // Resumo por fornecedor
      preencherResumoFornecedor(lic);

      // Abrir modal
      document.getElementById('modal-analise').classList.add('active');
    }

    function preencherTabelaSeuItens(lic) {
      const corpo = document.getElementById('tab-seus-itens-corpo');
      corpo.innerHTML = '';

      if (!lic.itens || lic.itens.length === 0) {
        corpo.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">Nenhum item ganho</td></tr>';
        return;
      }

      lic.itens.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.numero_item || ''}</td>
          <td>${item.descricao || ''}</td>
          <td>${item.quantidade || 0}</td>
          <td>${formatarMoeda(item.valor_unitario)}</td>
          <td><strong>${formatarMoeda(item.valor_total_item)}</strong></td>
          <td>${formatarData(item.data_homologacao)}</td>
        `;
        corpo.appendChild(tr);
      });
    }

    function preencherTabelaTodosFornecedores(lic) {
      const corpo = document.getElementById('tab-todos-fornecedores-corpo');
      corpo.innerHTML = '';

      if (!lic.itens_todos_fornecedores || lic.itens_todos_fornecedores.length === 0) {
        corpo.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #999;">Sem dados</td></tr>';
        return;
      }

      lic.itens_todos_fornecedores.forEach(item => {
        const tr = document.createElement('tr');
        const isVoce = (item.cnpj_fornecedor || '').includes('08778201000126') || 
                       (item.cnpj_fornecedor || '').replace(/\D/g, '') === '08778201000126';
        
        let tagStatus = '';
        if (item.situacao === 'Venceu') {
          tagStatus = '<span class="tag tag-ok">Venceu</span>';
        } else if (item.situacao === 'SemResultado') {
          tagStatus = '<span class="tag tag-bad">Sem resultado</span>';
        }

        const destaque = isVoce ? 'style="background: #e0f2fe !important; font-weight: 600;"' : '';

        tr.innerHTML = `
          <td ${destaque}>${item.numero_item || ''}</td>
          <td ${destaque}>${item.descricao || ''}</td>
          <td ${destaque}>${item.fornecedor || 'Sem identifica√ß√£o'} ${isVoce ? '<span class="tag tag-ok">‚úì Voc√™</span>' : ''}</td>
          <td ${destaque}>${item.cnpj_fornecedor || ''}</td>
          <td ${destaque}>${item.quantidade || 0}</td>
          <td ${destaque}>${formatarMoeda(item.valor_unitario)}</td>
          <td ${destaque}>${formatarMoeda(item.valor_total_item)}</td>
          <td ${destaque}>${formatarData(item.data_homologacao)}</td>
          <td ${destaque}>${tagStatus}</td>
        `;
        corpo.appendChild(tr);
      });
    }

    function preencherTabelaFracassados(lic) {
      const corpo = document.getElementById('tab-fracassados-corpo');
      corpo.innerHTML = '';

      const fracassados = (lic.itens_todos_fornecedores || []).filter(i => i.situacao === 'SemResultado');

      if (fracassados.length === 0) {
        corpo.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">Nenhum item fracassado</td></tr>';
        return;
      }

      fracassados.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.numero_item || ''}</td>
          <td>${item.descricao || ''}</td>
          <td>${item.quantidade || 0}</td>
          <td>${formatarMoeda(item.valor_unitario)}</td>
          <td>${formatarMoeda(item.valor_total_item)}</td>
          <td><span class="tag tag-bad">Sem resultado</span></td>
        `;
        corpo.appendChild(tr);
      });
    }

    function preencherResumoFornecedor(lic) {
      const corpo = document.getElementById('tab-resumo-fornecedor-corpo');
      corpo.innerHTML = '';

      const resumoMap = new Map();
      
      (lic.itens || []).forEach(item => {
        const key = item.fornecedor + '||' + item.cnpj_fornecedor;
        if (!resumoMap.has(key)) {
          resumoMap.set(key, { nome: item.fornecedor, cnpj: item.cnpj_fornecedor, total: 0 });
        }
        resumoMap.get(key).total += item.valor_total_item || 0;
      });

      if (resumoMap.size === 0) {
        corpo.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #999;">Sem dados</td></tr>';
        return;
      }

      Array.from(resumoMap.values())
        .sort((a, b) => b.total - a.total)
        .forEach(forn => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><strong>${forn.nome || 'Sem identifica√ß√£o'}</strong></td>
            <td>${forn.cnpj || ''}</td>
            <td style="text-align: right; font-weight: 600; color: var(--success);">
              ${formatarMoeda(forn.total)}
            </td>
          `;
          corpo.appendChild(tr);
        });
    }

    function formatarData(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      if (isNaN(d)) return '';
      return d.toLocaleDateString('pt-BR');
    }

    function formatarMoeda(v) {
      if (v === null || v === undefined) return 'R$ 0,00';
      const n = Number(v);
      if (isNaN(n)) return 'R$ 0,00';
      return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // Event listeners
    document.getElementById('btn-aplicar').addEventListener('click', aplicarFiltros);
    document.getElementById('btn-limpar').addEventListener('click', () => {
      document.getElementById('busca').value = '';
      document.getElementById('filtro-uf').value = '';
      dadosFiltrados = dadosCompletos.slice();
      paginaAtual = 1;
      atualizarTabela();
    });

    document.getElementById('prev-page').addEventListener('click', () => {
      if (paginaAtual > 1) {
        paginaAtual--;
        atualizarTabela();
      }
    });

    document.getElementById('next-page').addEventListener('click', () => {
      const total = dadosFiltrados.length;
      const totalPaginas = Math.max(1, Math.ceil(total / ITENS_POR_PAGINA));
      if (paginaAtual < totalPaginas) {
        paginaAtual++;
        atualizarTabela();
      }
    });

    document.getElementById('modal-fechar').addEventListener('click', () => {
      document.getElementById('modal-analise').classList.remove('active');
    });

    document.getElementById('modal-analise').addEventListener('click', (e) => {
      if (e.target.id === 'modal-analise') {
        document.getElementById('modal-analise').classList.remove('active');
      }
    });

    // Abas do modal
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tabName = btn.getAttribute('data-tab');
        
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        
        btn.classList.add('active');
        document.getElementById(tabName).classList.add('active');
      });
    });

    document.addEventListener('DOMContentLoaded', carregarDadosPncp);
  </script>
</body>
</html>
