<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PNCP Monitor - Preg√£o Eletr√¥nico</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* [MESMOS ESTILOS DA VERS√ÉO ANTERIOR + MODAL] */
    :root {
      --primary: #1e40af;
      --primary-dark: #1e3a8a;
      --success: #059669;
      --warning: #d97706;
      --danger: #dc2626;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --border: #e2e8f0;
    }

    /* [TODOS OS ESTILOS ANTERIORES permanecem iguais...] */
    
    /* NOVO: Modal de itens */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: var(--card);
      margin: 5% auto;
      padding: 0;
      border-radius: 12px;
      width: 90%;
      max-width: 1000px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-header {
      padding: 20px 24px;
      background: var(--primary);
      color: white;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .close {
      color: white;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
    }

    .close:hover {
      opacity: 0.7;
    }

    .itens-table {
      width: 100%;
      border-collapse: collapse;
    }

    .itens-table th,
    .itens-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .itens-table th {
      background: #f8fafc;
      font-weight: 600;
    }

    .btn-expand {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 1.1rem;
      padding: 4px 8px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .btn-expand:hover {
      background: rgba(30,64,175,0.1);
    }

    /* [resto dos estilos permanece igual] */
    body { /* ... mesmos estilos ... */ }
    /* ... */
  </style>
</head>
<body>
  <!-- [MESMA ESTRUTURA HEADER/STATS/CONTROLS/CHARTS] -->
  
  <div class="container">
    <!-- Header, stats, controls, charts [iguais √† vers√£o anterior] -->
    
    <div class="table-container">
      <table id="tabela-licitacoes">
        <thead>
          <tr>
            <th>√ìrg√£o/UASG</th>
            <th>√ìrg√£o</th>
            <th>Preg√£o</th>
            <th>ID PNCP</th>
            <th>Per√≠odo</th>
            <th>Cidade/UF</th>
            <th>Objeto</th>
            <th>Itens</th>  <!-- NOVA COLUNA -->
          </tr>
        </thead>
        <tbody id="corpo-tabela"></tbody>
      </table>
    </div>
  </div>

  <!-- NOVO MODAL DE ITENS -->
  <div id="modal-itens" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-titulo">Itens da Licita√ß√£o</h2>
        <button class="close" onclick="fecharModal()">&times;</button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- Conte√∫do dos itens aqui -->
      </div>
    </div>
  </div>

  <script>
    // [FUN√á√ïES ANTERIORES permanecem iguais...]

    function criarLinhaLicitacao(lic, index) {
      const tr = document.createElement('tr');
      tr.className = 'linha-licitacao';
      tr.dataset.index = index;  // para abrir modal
      
      const orgaoUasg = `${lic.orgao_codigo || ''}/${lic.uasg || ''}`;
      const periodo = `${formatarData(lic.data_inicio_propostas)} a ${formatarData(lic.data_fim_propostas)}`;
      const qtdItens = lic.itens?.length || 0;
      
      tr.innerHTML = `
        <td>${orgaoUasg}</td>
        <td>${lic.orgao_nome || ''}</td>
        <td>${lic.numero_pregao || ''}</td>
        <td><a href="${lic.link_edital || '#'}" target="_blank">${lic.id_pncp || ''}</a></td>
        <td>${periodo}</td>
        <td>${lic.cidade || ''}/${lic.uf || ''}</td>
        <td>${lic.objeto?.substring(0, 60)}${lic.objeto?.length > 60 ? '...' : ''}</td>
        <td>
          <button class="btn-expand" onclick="abrirModalItens(${index})">
            üìã ${qtdItens} item${qtdItens !== 1 ? 's' : ''}
          </button>
        </td>
      `;
      return tr;
    }

    // NOVA FUN√á√ÉO: Modal de itens
    function abrirModalItens(index) {
      const lic = dadosFiltrados[index];
      if (!lic || !lic.itens) return;
      
      document.getElementById('modal-titulo').textContent = 
        `Itens - ${lic.numero_pregao} (${lic.orgao_nome})`;
      
      const body = document.getElementById('modal-body');
      let html = `
        <table class="itens-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Descri√ß√£o</th>
              <th>Data Homolog.</th>
              <th>Qtd</th>
              <th>Unit. (R$)</th>
              <th>Total (R$)</th>
              <th>Fornecedor</th>
              <th>Situa√ß√£o</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      lic.itens.forEach(item => {
        const situacao = item.situacao === 'Venceu' ? 
          '<span class="badge badge-venceu">‚úÖ Venceu</span>' : 
          '<span class="badge badge-sem">‚ö†Ô∏è ' + (item.situacao || 'Sem resultado') + '</span>';
          
        html += `
          <tr>
            <td>${item.numero_item || ''}</td>
            <td>${item.descricao || ''}</td>
            <td>${formatarData(item.data_homologacao)}</td>
            <td>${item.quantidade || ''}</td>
            <td class="valor">${formatarMoeda(item.valor_unitario)}</td>
            <td class="valor">${formatarMoeda(item.valor_total_item)}</td>
            <td>${item.fornecedor || '-'}</td>
            <td>${situacao}</td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      body.innerHTML = html;
      
      document.getElementById('modal-itens').style.display = 'block';
    }

    function fecharModal() {
      document.getElementById('modal-itens').style.display = 'none';
    }

    // Fecha modal clicando fora
    window.onclick = function(event) {
      const modal = document.getElementById('modal-itens');
      if (event.target === modal) {
        fecharModal();
      }
    }

    // ESC fecha modal
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') fecharModal();
    });

    // [resto das fun√ß√µes permanece igual]
  </script>
</body>
</html>
