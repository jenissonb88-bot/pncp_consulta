<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Sniper PNCP Global</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; }
        .header-bg { background: #1e293b; color: white; padding: 2rem 0; margin-bottom: 2rem; }
        .card-lic { border: none; border-radius: 10px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 1rem; background: white; transition: 0.2s; }
        .card-lic:hover { transform: translateY(-3px); }
        .status-badge { font-size: 0.7rem; padding: 0.3rem 0.6rem; border-radius: 50px; font-weight: bold; text-transform: uppercase; }
        .status-homologada { background: #dcfce7; color: #166534; }
        .status-divulgada { background: #dbeafe; color: #1e40af; }
        .status-deserta { background: #fef9c3; color: #854d0e; }
        .status-fracassada { background: #fee2e2; color: #991b1b; }
        .objeto-preview { color: #64748b; font-size: 0.85rem; margin: 10px 0; }
    </style>
</head>
<body>

<div class="header-bg">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <h1 class="h3 mb-0">ðŸŽ¯ SNIPER PNCP GLOBAL</h1>
            <p class="mb-0 opacity-75">SaÃºde, Medicamentos e Insumos</p>
        </div>
        <div class="text-end">
            <h2 class="h4 mb-0" id="dash-valor">R$ 0,00</h2>
            <small id="dash-count">0 licitaÃ§Ãµes</small>
        </div>
    </div>
</div>

<div class="container">
    <div class="row mb-4">
        <div class="col-md-12">
            <input type="text" id="search" class="form-control form-control-lg border-0 shadow-sm" placeholder="ðŸ” Buscar por Ã“rgÃ£o, MunicÃ­pio ou Objeto...">
        </div>
    </div>
    <div id="loading" class="text-center py-5"><div class="spinner-border text-primary"></div></div>
    <div id="lista"></div>
</div>

<script>
    const fmt = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    const fmtDt = (d) => d ? new Date(d).toLocaleString('pt-BR') : '---';

    async function load() {
        const r = await fetch('dados_pncp.json?v=' + Date.now());
        const dados = await r.json();
        dados.sort((a,b) => b.Licitacao.localeCompare(a.Licitacao));
        
        let total = 0;
        dados.forEach(l => l.Itens.forEach(i => total += (i.Total || 0)));
        document.getElementById('dash-valor').innerText = fmt(total);
        document.getElementById('dash-count').innerText = `${dados.length} licitaÃ§Ãµes monitoradas`;
        
        render(dados);
        document.getElementById('loading').style.display = 'none';

        document.getElementById('search').onkeyup = (e) => {
            const t = e.target.value.toLowerCase();
            render(dados.filter(l => l.Orgao.toLowerCase().includes(t) || l.Municipio.toLowerCase().includes(t) || l.Objeto.toLowerCase().includes(t)));
        };
    }

    function render(lista) {
        const cont = document.getElementById('lista');
        cont.innerHTML = lista.map((l, idx) => `
            <div class="card-lic p-4">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <span class="status-badge status-${l.Status.toLowerCase().replace('Ã£','a')}">${l.Status}</span>
                        <h6 class="fw-bold mt-2 mb-1">${l.Orgao}</h6>
                        <small class="text-muted">${l.Municipio} - ${l.UF}</small>
                        <p class="objeto-preview">${l.Objeto || 'Sem descriÃ§Ã£o'}</p>
                    </div>
                    <div class="col-md-3 text-end">
                        <div class="small text-muted">VALOR TOTAL</div>
                        <div class="fw-bold text-success">${fmt(l.Itens.reduce((a,i) => a+(i.Total||0), 0))}</div>
                    </div>
                    <div class="col-md-3 text-end">
                        <button class="btn btn-sm btn-primary" data-bs-toggle="collapse" data-bs-target="#it-${idx}">Itens</button>
                        <a href="${l.Link}" target="_blank" class="btn btn-sm btn-outline-dark">PNCP</a>
                    </div>
                </div>
                <div class="collapse mt-3" id="it-${idx}">
                    <div class="table-responsive">
                        <table class="table table-sm small">
                            <thead><tr class="table-light"><th>Item</th><th>Desc</th><th>Status</th><th class="text-end">Total</th><th>Vencedor</th></tr></thead>
                            <tbody>${l.Itens.map(i => `
                                <tr>
                                    <td>${i.Item}</td>
                                    <td>${i.Desc}</td>
                                    <td><span class="status-badge status-${i.Status.toLowerCase().replace('Ã£','a')}">${i.Status}</span></td>
                                    <td class="text-end fw-bold">${fmt(i.Total||0)}</td>
                                    <td>${i.Vencedor || '-'}</td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `).join('');
    }
    load();
</script>
</body>
</html>
