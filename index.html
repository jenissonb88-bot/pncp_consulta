<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel PNCP Sniper 2026 - Licita√ß√µes e Preg√µes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f6f9; }
        .header-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem 0; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card-licitacao { border: none; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 1.5rem; transition: transform 0.2s; background: white; }
        .card-licitacao:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .status-badge { font-size: 0.8rem; padding: 0.4em 0.8em; border-radius: 20px; font-weight: 600; }
        .status-venceu { background-color: #d1e7dd; color: #0f5132; }
        .status-eletronico { background-color: #cfe2ff; color: #084298; }
        .valor-total { font-size: 1.1rem; font-weight: 700; color: #198754; }
        .btn-expandir { border-radius: 20px; font-size: 0.9rem; }
        .table-itens th { background-color: #f8f9fa; font-size: 0.85rem; text-transform: uppercase; color: #6c757d; }
        .table-itens td { vertical-align: middle; font-size: 0.9rem; }
        .info-prazos { background-color: #e7f3ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #667eea; }
        .info-label { font-size: 0.75rem; text-transform: uppercase; color: #6c757d; font-weight: 700; display: block; margin-bottom: 2px; }
        .info-value { font-size: 0.95rem; font-weight: 600; color: #212529; }
        .num-pregao-destaque { font-size: 1.2rem; color: #667eea; font-weight: 800; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .id-pncp { font-family: 'Courier New', monospace; color: #666; font-size: 0.85rem; background: #f8f9fa; padding: 4px 8px; border-radius: 4px; display: inline-block; }
        .badge-uasg { background-color: #6c757d; color: white; font-size: 0.75rem; vertical-align: middle; margin-left: 8px; }
        .pregao-eletronico { border-left: 4px solid #0dcaf0 !important; }
        #loading { display: none; }
    </style>
</head>
<body>

    <div class="header-bg">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="fw-bold mb-0"><i class="fas fa-gavel me-2"></i>Painel PNCP Sniper 2026</h1>
                    <p class="mb-0 opacity-75">Monitoramento de Preg√µes Eletr√¥nicos e Licita√ß√µes P√∫blicas</p>
                </div>
                <div class="text-end">
                    <span class="badge bg-light text-primary fs-6" id="total-valor">R$ 0,00</span>
                    <div class="small mt-1 text-white-50" id="last-update">Atualizando...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm p-3 text-center">
                    <div class="text-muted small text-uppercase fw-bold">Preg√µes Monitorados</div>
                    <div class="h2 mb-0 fw-bold text-primary" id="count-pregoes">0</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm p-3 text-center">
                    <div class="text-muted small text-uppercase fw-bold">Itens Licitados</div>
                    <div class="h2 mb-0 fw-bold text-success" id="count-itens">0</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm p-3 text-center">
                    <div class="text-muted small text-uppercase fw-bold">Munic√≠pios</div>
                    <div class="h2 mb-0 fw-bold text-info" id="count-municipios">0</div>
                </div>
            </div>
            <div class="col-md-3">
                <input type="text" id="searchInput" class="form-control form-control-lg border-0 shadow-sm" placeholder="üîç Buscar N¬∫ Preg√£o, √ìrg√£o, Cidade ou UASG...">
            </div>
        </div>

        <div id="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 text-muted">Carregando dados PNCP...</p>
        </div>

        <div id="container-licitacoes"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Formata Moeda
        const formatMoney = (value) => {
            return parseFloat(value || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        // Formata Data
        const formatDate = (dateStr) => {
            if (!dateStr) return '<span class="text-muted">N/D</span>';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('pt-BR') + '<br><small>' + date.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}) + '</small>';
            } catch {
                return dateStr;
            }
        };

        let dadosGlobais = [];

        // Dados reais PNCP + mock expandidos
        async function carregarDados() {
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Tenta API real primeiro
                const response = await fetch('https://api.pncp.gov.br/v1/licitacoes?_limit=50', {
                    headers: { 'Accept': 'application/json' }
                });
                
                let dados = [];
                if (response.ok) {
                    dados = await response.json();
                } else {
                    // Fallback mock com dados reais do usu√°rio + mais exemplos
                    dados = obterDadosMock();
                }

                dadosGlobais = dados;
                dadosGlobais.sort((a, b) => new Date(b.data_resultado || b.data_homologacao) - new Date(a.data_resultado || a.data_homologacao));

                atualizarDashboard(dadosGlobais);
                renderizarLista(dadosGlobais);
                
            } catch (error) {
                console.error('Erro API:', error);
                dadosGlobais = obterDadosMock();
                atualizarDashboard(dadosGlobais);
                renderizarLista(dadosGlobais);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Dados mock expandidos com formato real PNCP
        function obterDadosMock() {
            return [
                {
                    "id_licitacao": "08084014000142000572024",
                    "numero_pregao": "25/2024",
                    "orgao_nome": "MUNICIPIO DE CAMPO GRANDE",
                    "orgao_codigo": "08084014000142",
                    "uasg": "08084014000142",
                    "cidade": "Campo Grande",
                    "uf": "RN",
                    "objeto": "AQUISI√á√ÉO DE MATERIAIS PERMANENTE DESTINADOS AO DESENVOLVIMENTO DO ENSINO FUNDAMENTAL DAS ESCOLAS MUNICIPAIS DE CAMPO GRANDE/RN.",
                    "link_edital": "https://pncp.gov.br/app/editais/08084014000142/2024/57",
                    "data_resultado": "2025-01-02T04:11:23",
                    "data_inicio_propostas": null,
                    "data_fim_propostas": null,
                    "id_pncp": null,
                    "cnpj_fornecedor": "08778201000126",
                    "tipo": "eletronico",
                    "itens": [
                        {"numero_item": "001", "descricao": "Materiais permanentes educa√ß√£o", "quantidade": 50, "valor_unitario": 250.00, "valor_total": 12500.00}
                    ]
                },
                {
                    "id_licitacao": "08778201000126",
                    "numero_pregao": "20250101-0001",
                    "orgao_nome": "Universidade Federal de Pernambuco",
                    "orgao_codigo": "26296",
                    "uasg": "150000",
                    "cidade": "Recife",
                    "uf": "PE",
                    "objeto": "Fornecimento de medicamentos",
                    "link_edital": "https://pncp.gov.br/app/editais/26296/2025/1",
                    "data_resultado": "2025-01-05T00:00:00",
                    "data_inicio_propostas": "2025-01-01",
                    "data_fim_propostas": "2025-01-03",
                    "id_pncp": "08778201000126",
                    "cnpj_fornecedor": "12.345.678/0001-90",
                    "tipo": "eletronico",
                    "itens": [
                        {"numero_item": "001", "descricao": "Paracetamol 500mg", "quantidade": 100, "valor_unitario": 1.50, "valor_total": 150.00}
                    ]
                },
                {
                    "id_licitacao": "08778201000127",
                    "numero_pregao": "20250102-0002",
                    "orgao_nome": "Secretaria de Educa√ß√£o",
                    "orgao_codigo": "26297",
                    "uasg": "150001",
                    "cidade": "Recife",
                    "uf": "PE",
                    "objeto": "Material de escrit√≥rio",
                    "link_edital": "https://pncp.gov.br/app/editais/26297/2025/2",
                    "data_resultado": "2025-01-06T00:00:00",
                    "data_inicio_propostas": "2025-01-02",
                    "data_fim_propostas": "2025-01-05",
                    "id_pncp": "08778201000127",
                    "cnpj_fornecedor": "23.456.789/0001-01",
                    "tipo": "presencial",
                    "itens": [
                        {"numero_item": "001", "descricao": "Papel A4 (resma)", "quantidade": 50, "valor_unitario": 25.00, "valor_total": 1250.00},
                        {"numero_item": "002", "descricao": "Canetas azuis", "quantidade": 500, "valor_unitario": 0.50, "valor_total": 250.00}
                    ]
                }
            ];
        }

        function atualizarDashboard(dados) {
            let totalVal = 0;
            let totalItens = 0;
            let totalMun = new Set();

            dados.forEach(lic => {
                totalMun.add(lic.cidade);
                lic.itens.forEach(item => {
                    totalVal += item.valor_total;
                    totalItens++;
                });
            });

            document.getElementById('total-valor').innerText = formatMoney(totalVal);
            document.getElementById('count-pregoes').innerText = dados.length;
            document.getElementById('count-itens').innerText = totalItens;
            document.getElementById('count-municipios').innerText = totalMun.size;
            
            const agora = new Date();
            document.getElementById('last-update').innerText = 'Atualizado: ' + agora.toLocaleDateString('pt-BR') + ' ' + agora.toLocaleTimeString();
        }

        function renderizarLista(dados) {
            const container = document.getElementById('container-licitacoes');
            container.innerHTML = '';

            if (dados.length === 0) {
                container.innerHTML = '<div class="text-center text-muted py-5"><i class="fas fa-search fa-3x mb-3 opacity-50"></i><h5>Nenhum preg√£o encontrado</h5></div>';
                return;
            }

            dados.forEach((lic, index) => {
                const totalLic = lic.itens.reduce((acc, it) => acc + (it.valor_total || 0), 0);
                const classeCard = lic.tipo === 'eletronico' ? 'pregao-eletronico' : '';
                
                const card = document.createElement('div');
                card.className = `card-licitacao p-4 ${classeCard}`;
                
                card.innerHTML = `
                    <div class="row align-items-center">
                        <div class="col-md-1 text-center">
                            <div class="bg-light rounded-circle d-inline-flex justify-content-center align-items-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-gavel text-primary fs-4"></i>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="num-pregao-destaque mb-1">${lic.numero_pregao}</div>
                            <h6 class="mb-1 text-dark fw-bold">${lic.orgao_nome}</h6>
                            <div class="text-muted small">
                                <i class="fas fa-map-marker-alt me-1"></i> ${lic.cidade} - ${lic.uf}
                                <span class="badge badge-uasg">UASG: ${lic.uasg}</span>
                                ${lic.tipo === 'eletronico' ? '<span class="status-badge status-eletronico ms-2"><i class="fas fa-laptop"></i> Eletr√¥nico</span>' : ''}
                            </div>
                        </div>
                        <div class="col-md-3 text-end">
                            <div class="text-muted small text-uppercase">Valor Total</div>
                            <div class="valor-total">${formatMoney(totalLic)}</div>
                            <div class="small text-muted">${lic.itens.length} item(s)</div>
                        </div>
                        <div class="col-md-3 text-end">
                            <a href="${lic.link_edital || '#'}" target="_blank" class="btn btn-outline-primary btn-sm me-2 mb-1">
                                <i class="fas fa-external-link-alt"></i> Edital
                            </a>
                            <button class="btn btn-primary btn-sm btn-expandir mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${index}">
                                Ver Detalhes <i class="fas fa-chevron-down ms-1"></i>
                            </button>
                        </div>
                    </div>

                    <div class="collapse mt-3" id="collapse-${index}">
                        <div class="info-prazos">
                            <div class="row">
                                <div class="col-md-3">
                                    <span class="info-label"><i class="fas fa-calendar-check me-1"></i> Data Resultado</span>
                                    <span class="info-value">${formatDate(lic.data_resultado)}</span>
                                </div>
                                <div class="col-md-3">
                                    <span class="info-label"><i class="far fa-calendar me-1"></i> In√≠cio Propostas</span>
                                    <span class="info-value">${formatDate(lic.data_inicio_propostas)}</span>
                                </div>
                                <div class="col-md-3">
                                    <span class="info-label"><i class="far fa-calendar-times me-1"></i> Fim Propostas</span>
                                    <span class="info-value">${formatDate(lic.data_fim_propostas)}</span>
                                </div>
                                <div class="col-md-3">
                                    <span class="info-label"><i class="fas fa-fingerprint me-1"></i> ID PNCP</span>
                                    <span class="id-pncp">${lic.id_pncp || 'N/A'}</span>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <span class="info-label">Objeto</span>
                                    <span class="info-value text-truncate d-block" style="max-width: 100%;">${lic.objeto}</span>
                                </div>
                                <div class="col-md-6">
                                    <span class="info-label">Fornecedor</span>
                                    <span class="info-value">${lic.cnpj_fornecedor} - ${lic.orgao_nome}</span>
                                </div>
                            </div>
                        </div>

                        ${lic.itens && lic.itens.length > 0 ? `
                        <div class="table-responsive">
                            <table class="table table-itens table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Descri√ß√£o</th>
                                        <th class="text-center">Qtd</th>
                                        <th class="text-end">Unit.</th>
                                        <th class="text-end">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${lic.itens.map(item => `
                                        <tr>
                                            <td class="fw-bold text-center bg-light">${item.numero_item}</td>
                                            <td class="text-truncate" style="max-width: 300px;" title="${item.descricao}">${item.descricao}</td>
                                            <td class="text-center">${item.quantidade || 0}</td>
                                            <td class="text-end">${formatMoney(item.valor_unitario)}</td>
                                            <td class="text-end fw-bold text-success">${formatMoney(item.valor_total)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : '<div class="text-muted text-center py-3">Itens n√£o dispon√≠veis</div>'}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Busca em tempo real (prioriza N¬∫ Preg√£o)
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            const termo = e.target.value.toLowerCase().trim();
            const dadosFiltrados = dadosGlobais.filter(lic => 
                (lic.numero_pregao && lic.numero_pregao.toLowerCase().includes(termo)) ||
                lic.orgao_nome.toLowerCase().includes(termo) ||
                lic.cidade.toLowerCase().includes(termo) ||
                lic.uf.toLowerCase().includes(termo) ||
                (lic.uasg && lic.uasg.includes(termo)) ||
                (lic.id_pncp && lic.id_pncp.toLowerCase().includes(termo))
            );
            renderizarLista(dadosFiltrados);
        });

        // Auto-refresh a cada 10 minutos
        setInterval(carregarDados, 600000);

        // Inicializar
        carregarDados();
    </script>
</body>
</html>
